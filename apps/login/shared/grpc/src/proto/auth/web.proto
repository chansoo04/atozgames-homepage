syntax = "proto3";

package web;

message WebUser {
  string name = 1;
  string tel_code = 2;
  string tel = 3;
}

message WebAccount {
  string uid = 1; // Firebase Auth UID
  string account_id = 2;
  string account_type = 3;
  string account_name = 4; // 계정명
  string nickname = 5; // 닉네임
}

service WebAuthService {
  rpc CreateCustomToken(CreateCustomTokenRequest) returns (CreateCustomTokenResponse); // Firebase Auth 커스텀 토큰 발급
  rpc VerifyIdToken(TokenRequest) returns (TokenResponse); // Firebase Auth ID 토큰 검증 / accessToken
  rpc AccountSignIn(AccountSignRequest) returns (AccountSignResponse);
  rpc AccountSignOut(AccountSignOutRequest) returns (DefaultResponse);
}

message CreateCustomTokenRequest {
  string provider = 1;
  string token = 2;
}

enum CustomTokenIssueType {
  EXIST = 0; // 기존 유저
  NEW = 1; // 신규 유저 등록
}

message CreateCustomTokenResponse {
  bool success = 1;
  string error_message = 2;
  string custom_token = 3;
  CustomTokenIssueType issue_type = 4;
}

message TokenRequest {
  string uid = 1;
  string token = 2; // 본인인증 서비스에서 발급한 토큰
}

message TokenResponse {
  bool success = 1;
  string error_message = 2;
  string auth_code = 3;
  string renewed_token = 4; // 갱신된 토큰
}

message AccountSignRequest {
  string user_id = 1;
  string credential = 2;
  string provider = 3;
  string push_token = 4;
}

message AccountSignResponse {
  bool success = 1;
  string error_message = 2;
  string token = 3;
  WebUser user = 4;
  WebAccount account = 5;
}

message AccountSignOutRequest {
  string uid = 1;
}

message DefaultResponse {
  bool success = 1;
  string error_message = 2;
}
