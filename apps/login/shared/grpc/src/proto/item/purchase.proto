syntax = "proto3";

package item;

import "item-common.proto";

message MonthlyPurchase {
  string user_id = 1;
  bool purchasable = 2;
  int32 remain_amount = 3;
  int32 year = 4;
  int32 month = 5;
  int32 purchase_count = 6;
  int32 purchase_price = 7;
  int32 subscription_count = 8;
  int32 subscription_price = 9;
}

message SubscriptionReceipt {
  string subscription_receipt_id = 1;
  string platform = 2;
  string product_id = 3;
  string original_transaction_id = 4;
  string latest_transaction_id = 5;
  string status = 6;
  string expires_at = 7;
  string started_at = 8;
  string canceled_at = 9;
  bool is_auto_renew = 10;
}

message PurchaseReceipt {
  string purchase_receipt_id = 1;
  string transaction_id = 2;
  string product_id = 3;
  int32 quantity = 4;
  int32 price = 5;
}

service PurchaseService {
  rpc MonthlyPurchase(UserIdRequest) returns (MonthlyPurchaseResponse) {}
  rpc ApplePurchase(PurchaseRequest) returns (PurchaseResponse) {}
  rpc GooglePurchase(PurchaseRequest) returns (PurchaseResponse) {}

  // for store subscription callback
  rpc AppleSubscription(PurchaseRequest) returns (SubscriptionResponse) {}
  rpc GoogleSubscription(PurchaseRequest) returns (SubscriptionResponse) {}
  rpc AppleSubscriptionCallback(AppleSubscriptionRequest) returns (EmptyResponse) {}
  rpc GoogleSubscriptionCallback(GoogleSubscriptionRequest) returns (EmptyResponse) {}
  rpc GoogleNotification(NotificationRequest) returns (EmptyResponse) {}
  rpc AppleNotification(NotificationRequest) returns (EmptyResponse) {}
}

message NotificationRequest {
  string body = 1;
}

message UserIdRequest {
  string user_id = 1;
}

message MonthlyPurchaseResponse {
  bool success = 1;
  string error_message = 2;
  MonthlyPurchase monthly = 3;
}

message PurchaseRequest {
  string user_id = 1;
  string account_id = 2;
  string raw_receipt = 3;
  string product_id = 4;
}

message PurchaseResponse {
  bool success = 1;
  string error_message = 2;
  PurchaseReceipt receipt = 3;
  MonthlyPurchase monthly = 4;
  PostBox post_box = 5;
  repeated Inventory inventory = 6;
  string gold = 7;
}

message SubscriptionResponse {
  bool success = 1;
  string error_message = 2;
  SubscriptionReceipt receipt = 3;
  MonthlyPurchase monthly = 4;
  PostBox post_box = 5;
  repeated Inventory inventory = 6;
  string gold = 7;
}

message AppleSubscriptionRequest {
  string jwt = 1; // JWT from Apple
}

message GoogleSubscriptionRequest {
  string jwt = 1; // JWT from Google
}
